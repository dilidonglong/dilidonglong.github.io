<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  
    <meta name="keywords" content="network,linux">
  
  
    <meta name="description" content="精卫衔微木，将以填沧海">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    科学上网 |
    
    望伊如西の博客</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">
  
  <script src="/js/pace.min.js"></script>
</head>
</html>
<body>
<main class="content">
  <section class="outer">
  

<article id="post-科学上网" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      科学上网
    </h1>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2019/09/25/科学上网/" class="article-date">
  <time datetime="2019-09-25T14:21:48.000Z" itemprop="datePublished">2019-09-25</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/小技巧/">小技巧</a>
  </div>

      </div>
    

    
      
    <div class="tocbot"></div>





    

    <div class="article-entry" itemprop="articleBody">
      


      

      
        <h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h2><p>该篇文档为自己所做笔记，防止后续忘记如何部署。</p>
<a id="more"></a>

<h2 id="2-V2Ray-简单部署"><a href="#2-V2Ray-简单部署" class="headerlink" title="2.V2Ray 简单部署"></a>2.V2Ray 简单部署</h2><h3 id="2-1-V2Ray服务器部署"><a href="#2-1-V2Ray服务器部署" class="headerlink" title="2.1 V2Ray服务器部署"></a><a href="https://www.rootfw.com/en/posts/f3e24172.html" target="_blank" rel="noopener">2.1 V2Ray服务器部署</a></h3><ol>
<li>安装依赖及执行以下代码</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum makecache</span><br><span class="line">yum install curl</span><br><span class="line"></span><br><span class="line">curl -O https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh</span><br><span class="line">curl -O https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-dat-release.sh</span><br><span class="line">bash install-release.sh</span><br><span class="line">bash install-dat-release.sh</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在/usr/local/etc/v2ray下面创建一个新的config.json配置文件</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"inbounds"</span>: [&#123;</span><br><span class="line">    <span class="string">"port"</span>: xxxx,           //此处为安装时生成的端口，可修改随意，但是保证和下面提到的端口号相同</span><br><span class="line">    <span class="string">"listen"</span>:<span class="string">"127.0.0.1"</span>,	//设置了监听地址后，后续在客户端上直接使用服务器IP是无法连接成功的</span><br><span class="line">    <span class="string">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line">    <span class="string">"settings"</span>: &#123;</span><br><span class="line">      <span class="string">"clients"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"id"</span>: <span class="string">"xxxxx-xxxx-xxxxx-xxxx-xxxxxx"</span>, //此处为安装时生成的id</span><br><span class="line">          <span class="string">"level"</span>: 1,</span><br><span class="line">          <span class="string">"alterId"</span>: 64      //此处为安装时生成的alterId</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"streamSettings"</span>: &#123;</span><br><span class="line">      <span class="string">"network"</span>: <span class="string">"ws"</span>,</span><br><span class="line">      <span class="string">"wsSettings"</span>: &#123;</span><br><span class="line">        <span class="string">"path"</span>: <span class="string">"/yuuka"</span>    //此处为路径，需要和下面NGINX上面的路径配置一样</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;],</span><br><span class="line">  <span class="string">"outbounds"</span>: [&#123;</span><br><span class="line">    <span class="string">"protocol"</span>: <span class="string">"freedom"</span>,</span><br><span class="line">    <span class="string">"settings"</span>: &#123;&#125;</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    <span class="string">"protocol"</span>: <span class="string">"blackhole"</span>,</span><br><span class="line">    <span class="string">"settings"</span>: &#123;&#125;,</span><br><span class="line">    <span class="string">"tag"</span>: <span class="string">"blocked"</span></span><br><span class="line">  &#125;],</span><br><span class="line">  <span class="string">"routing"</span>: &#123;</span><br><span class="line">    <span class="string">"rules"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"type"</span>: <span class="string">"field"</span>,</span><br><span class="line">        <span class="string">"ip"</span>: [<span class="string">"geoip:private"</span>],</span><br><span class="line">        <span class="string">"outboundTag"</span>: <span class="string">"blocked"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>启动V2Ray</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart v2ray</span><br><span class="line">systemctl status -l v2ray</span><br><span class="line">systemctl <span class="built_in">enable</span> v2ray</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>开启防火墙</li>
</ol>
<p>这个步骤一定不要漏，否则后面配置再久也没用。</p>
<p><strong>CentOS 7.0</strong> 默认使用的是 firewall 作为防火墙，而不是iptables。</p>
<ul>
<li>如果你的系统上没有安装，则使用命令安装：</li>
</ul>
<p>安装firewalld 防火墙</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install firewalld</span><br></pre></td></tr></table></figure>

<p><a href="https://www.jianshu.com/p/411274f96492" target="_blank" rel="noopener">其他常用命令：</a></p>
<blockquote>
<p>开启服务</p>
<p><code>systemctl start firewalld.service</code></p>
<p>关闭防火墙</p>
<p><code>systemctl stop firewalld.service</code></p>
<p>开机自动启动</p>
<p><code>systemctl enable firewalld.service</code></p>
<p>关闭开机制动启动</p>
<p><code>systemctl disable firewalld.service</code></p>
</blockquote>
<ul>
<li><p>开启防火墙上的端口。</p>
<p>– zone #作用域 </p>
<p>– add-port=80/tcp #添加端口，格式为：端口/通讯协议 </p>
<p>– permanent #永久生效，没有此参数重启后失效</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ss-1 ~]<span class="comment"># firewall-cmd --zone=public --add-port=11234/tcp --permanent</span></span><br><span class="line">[root@ss-1 ~]<span class="comment"># firewall-cmd --zone=public --remove-port=11234/tcp --permanent</span></span><br><span class="line">[root@ss-1 ~]<span class="comment">#firewall-cmd --list-all                       //查看防火墙规则</span></span><br></pre></td></tr></table></figure>

<br>

<p><strong>CentOS 6.0</strong>使用iptables规则，放通相应端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/iptables</span><br><span class="line"></span><br><span class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 11234 -j ACCEPT</span><br><span class="line"></span><br><span class="line">systemctl restart iptables.service <span class="comment">#重启防火墙使配置生效</span></span><br></pre></td></tr></table></figure>

<br>

<h3 id="2-2-V2Ray客户端使用"><a href="#2-2-V2Ray客户端使用" class="headerlink" title="2.2 V2Ray客户端使用"></a>2.2 V2Ray客户端使用</h3><p><a href="https://v2ray.com/awesome/tools.html" target="_blank" rel="noopener">神一样的工具们</a></p>
<ol>
<li><p>我在windows中，下载的上面的图形工具是V2RayW。其实解压了该压缩包，运行<strong>V2RayW.exe</strong>文件也会给出提示要下载V2Ray。</p>
</li>
<li><p>所以下载了V2RayW这个还不够，得需要下载V2Ray。</p>
</li>
<li><p>下载的V2RayW 的压缩包解压后，能看到<strong>V2RayW.exe</strong>文件。</p>
</li>
<li><p><strong>V2RayW.exe</strong>文件需要和<strong>v2ray-core</strong>文件夹在同一个目录下。<strong>v2ray-core</strong>文件夹存放V2Ray的文件。如果没有文件夹，则自动手动建立一个。</p>
</li>
<li><p><strong>v2ray-core</strong>文件夹内应该包含4个文件<strong>v2ray.exe、v2ctl.exe、geosite.dat、geoip.dat</strong></p>
</li>
</ol>
<img src="/2019/09/25/科学上网/2.png" title="This is an test image">

<br>

<ol start="6">
<li>运行该文件<strong>V2RayW.exe</strong>，在工具栏找到该图标，右键配置。</li>
</ol>
<img src="/2019/09/25/科学上网/3.png" title="This is an test image">

<ol start="7">
<li>照下图配置</li>
</ol>
<img src="/2019/09/25/科学上网/4.png" title="This is an test image">

<ol start="8">
<li>配置完后，选择加载V2Ray</li>
</ol>
<img src="/2019/09/25/科学上网/5.png" title="This is an test image">

<ol start="9">
<li>此时windows主机应该可以正常上网了</li>
</ol>
<br>

<h2 id="附录：给Centos7服务器开BBR加速"><a href="#附录：给Centos7服务器开BBR加速" class="headerlink" title="附录：给Centos7服务器开BBR加速"></a>附录：<a href="https://www.jianshu.com/p/52815c34215e" target="_blank" rel="noopener">给Centos7服务器开BBR加速</a></h2><h3 id="BBR介绍"><a href="#BBR介绍" class="headerlink" title="BBR介绍"></a>BBR介绍</h3><p>Google BBR (Bottleneck Bandwidth and RTT) 是一种新的TCP拥塞控制算法,它可以高效增加吞吐和降低网络延迟，并且Linux Kernel4.9+已经集成该算法。开启BBR也非常简单，因为它只需要在发送端开启，网络其他节点和接收端不需要任何改变。</p>
<h4 id="升级内核"><a href="#升级内核" class="headerlink" title="升级内核"></a>升级内核</h4><h5 id="1-打开Terminal"><a href="#1-打开Terminal" class="headerlink" title="1. 打开Terminal"></a>1. 打开Terminal</h5><p>输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># uname -r</span></span><br></pre></td></tr></table></figure>

<p>查看内核版本，如果输出类似</p>
<blockquote>
<p>3.10.0-514.21.2.el7.x86_64</p>
</blockquote>
<p>则表示小于4.9，需要升级内核，<br>而如果内核大于等于4.9则跳过至开启Google BBR</p>
<h5 id="2-升级内核"><a href="#2-升级内核" class="headerlink" title="2. 升级内核"></a>2. 升级内核</h5><ul>
<li><p>安装 ELRepo 仓库</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm --<span class="keyword">import</span> https:<span class="comment">//www.elrepo.org/RPM-GPG-KEY-elrepo.org</span></span><br><span class="line">rpm -Uvh http:<span class="comment">//www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>安装最新版kernel</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum --enablerepo=elrepo-kernel install kernel-ml -y</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>确认是否安装成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -qa | grep kernel</span></span><br></pre></td></tr></table></figure>

<p>如果输出类似如下，包含kernel-ml-4.13.10-1.el7.elrepo.x86_64，则表示安装成功</p>
<blockquote>
<p>kernel-3.10.0-693.el7.x86_64<br>kernel-tools-3.10.0-693.el7.x86_64<br>kernel-ml-4.13.10-1.el7.elrepo.x86_64<br>kernel-tools-libs-3.10.0-693.el7.x86_64</p>
</blockquote>
</li>
<li><p>设置开机默认启动项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># egrep ^menuentry /etc/grub2.cfg | cut -f 2 -d \'</span></span><br></pre></td></tr></table></figure>

<p>输出结果类似如下</p>
<blockquote>
<p>CentOS Linux 7 Rescue f212d2d7754a4a6bb2b98950c20cc0b5 (4.13.10-1.el7.elrepo.x86_64)<br>CentOS Linux (4.13.10-1.el7.elrepo.x86_64) 7 (Core)<br>CentOS Linux (3.10.0-693.el7.x86_64) 7 (Core)<br>CentOS Linux (0-rescue-d1f142097d497f24c021d7de9b81cab4) 7 (Core)</p>
</blockquote>
<p>该列表从0开始索引，所以4.13内核索引为1</p>
</li>
<li><p>设置启动项</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># grub2-<span class="built_in">set</span>-<span class="keyword">default</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>重启</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># reboot</span></span><br></pre></td></tr></table></figure>

<p>查看内核版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># uname -r</span></span><br></pre></td></tr></table></figure>

<p>如果输出类似</p>
<blockquote>
<p>4.13.10-1.el7.elrepo.x86_64</p>
</blockquote>
<p>则表示升级完成</p>
</li>
</ul>
<h4 id="开启Google-BBR"><a href="#开启Google-BBR" class="headerlink" title="开启Google BBR"></a>开启Google BBR</h4><ul>
<li><p>修改sysctl配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'net.core.default_qdisc=fq'</span> | tee -a /etc/sysctl.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'net.ipv4.tcp_congestion_control=bbr'</span> |  tee -a /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查是否加载BBR</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsmod | grep bbr</span></span><br></pre></td></tr></table></figure>

<p>如果输出结果包含tcp_bbr，则表示开启成功</p>
<blockquote>
<p>tcp_bbr 20480 0</p>
</blockquote>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.xilearn.top/2019/09/25/科学上网/" data-id="clmc13gq9001x0otf561zxs8r"
         class="article-share-link">分享</a>
      
    </footer>

  </div>

  
    
  <nav class="article-nav">
    
      <a href="/2019/09/27/使用CDN加速博客打开速度（Cloudflare）/" class="article-nav-link">
        <strong class="article-nav-caption">前一篇</strong>
        <div class="article-nav-title">
          
            使用CDN加速博客打开速度（Cloudflare）
          
        </div>
      </a>
    
    
      <a href="/2019/09/17/数据包的嗅探与欺骗实验/" class="article-nav-link">
        <strong class="article-nav-caption">后一篇</strong>
        <div class="article-nav-title">数据包的嗅探与欺骗实验</div>
      </a>
    
  </nav>


  

  
    
  <div class="gitalk" id="gitalk-container"></div>
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
  <script type="text/javascript">
    var gitalk = new Gitalk({
      clientID: '15c18d9b0a015598eb07',
      clientSecret: 'a3853e070f5ab7e4de32abbdda82175936eab5cf',
      repo: 'gitalk',
      owner: 'dilidonglong',
      admin: ['dilidonglong'],
      // id: location.pathname,      // Ensure uniqueness and length less than 50
      id: md5(location.pathname),
      distractionFreeMode: false,  // Facebook-like distraction free mode
      pagerDirection: 'last'
    })

  gitalk.render('gitalk-container')
  </script>

  

</article>



</section>
  <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>&copy; 2023 望伊如西の博客</li>
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>

</main>

<aside class="sidebar sidebar-specter">
  
    <button class="navbar-toggle"></button>
<nav class="navbar">
  
    <div class="logo">
      <a href="/"><img src="/images/hexo.svg" alt="望伊如西の博客"></a>
    </div>
  
  <ul class="nav nav-main">
    
      <li class="nav-item">
        <a class="nav-item-link" href="/">主页</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/archives">归档</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/gallery">相册</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/categories">分类</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/about">关于</a>
      </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="Search">
        <i class="fe fe-search"></i>
        搜索
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
        <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
          <i class="fe fe-feed"></i>
        </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
  </aside>
  <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/lazyload.min.js"></script>
<script src="/js/busuanzi-2.3.pure.min.js"></script>

  <script src="/fancybox/jquery.fancybox.min.js"></script>



  <script src="/js/tocbot.min.js"></script>
  <script>
    // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
    tocbot.init({
      tocSelector: '.tocbot',
      contentSelector: '.article-entry',
      headingSelector: 'h1, h2, h3, h4, h5, h6',
      hasInnerContainers: true,
      scrollSmooth: true,
      positionFixedSelector: '.tocbot',
      positionFixedClass: 'is-position-fixed',
      fixedSidebarOffset: 'auto',
    });
  </script>

<script src="/js/ocean.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/haruto.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body>
</html>